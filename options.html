<!DOCTYPE html>
<html>
<head>
<title>Social Media Monitoring Extension Options</title>
<link rel="shortcut icon" HREF="img/icon_16.png"> 
<link rel="stylesheet" type="text/css" href="css/options.css">
<style type="text/css">
  @import url("http://www.google.com/uds/css/gsearch.css");
  @import url("http://www.google.com/uds/solutions/localsearch/gmlocalsearch.css");
</style>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w&sensor=false"></script>
<script type="text/javascript" src="lib/geo_search.js"></script>

<script type="text/javascript" src="lib/3rdparty/jquery-1.4.2.min.js"></script>

<script type="text/javascript"> 
var bkg = chrome.extension.getBackgroundPage();

//Saves options to localStorage.
function save_options() {
	bkg.settings.pollInterval = parseInt($('#refresh-interval').val()) * 60000;
	bkg.settings.timeout = 1000 * 15;

	bkg.settings.soundAlert = $('#sound-alert').val();

	if($("#default_location_off").attr("checked")){
		bkg.settings.latitude = undefined;
		bkg.settings.longitude = undefined;
		bkg.settings.radius  = undefined;
	}else{
		bkg.settings.latitude = $("#lat").html();
		bkg.settings.longitude  = $("#lng").html();
		bkg.settings.radius  = $("#distance").val();
	}
	
	
	refresh_extension();

	$('#save_status').fadeIn('fast');
	$('#save_status').fadeOut(3000);
}

//Refresh the extension by reseting timer.
function refresh_extension() {
	bkg.refresh(); 
}


function playSound(){
	var urlSound = $('#sound-alert').val();

	  /*
	   * BUG: http://code.google.com/p/chromium/issues/detail?id=25972
	   */

	if(urlSound){
		pingSound = document.createElement('audio');
	    pingSound.setAttribute('src', urlSound);
	    pingSound.setAttribute('id', 'ping');
	    pingSound.load();
	    pingSound.play();
	}
}
/*
 * TODO: populate options interface 
 */
//Restores select box state to saved value from localStorage.
 $(function() {

	 $('#refresh-interval').val(bkg.settings.pollInterval / 60000);
	 $('#sound-alert').val(bkg.settings.soundAlert);

	 $("#lat").html(bkg.settings.latitude);
	 $("#lng").html(bkg.settings.longitude);
	 $("#distance").val(bkg.settings.radius);

	 if(bkg.settings.latitude == undefined || bkg.settings.latitude == 'undefined'){
		 $("#default_location_off").attr("checked", true);
		 $("div#geo_options").addClass('hd');
		 initMapSearch();
	 }else{
		 $("#default_location_on").attr("checked", true);
		 $("div#geo_options").removeClass('hd');
		 initMapSearch(bkg.settings.latitude, bkg.settings.longitude,function(){
			 markDirty()
		 });
	 }
	 

	 
		 
	 /*
	  * set  internatiolizaded values
	  */

	  $('#title').html(chrome.i18n.getMessage('options'));

	  $("input[name='defaut_location']").change(function(){
		  console.log($("input[name='defaut_location']").val());
		  if ($("input[name='defaut_location']:checked").val() == '1'){
			  $("div#geo_options").slideDown("fast");
			  markDirty();
		  }else{
			  $("div#geo_options").slideUp("fast");
			  markDirty();
	     }
	  });
	  

	 
 });
function searchAddress(adress){
	showAddress(adress,function(){markDirty()});
}
</script>
        
</head>
<body onload="_initOptionsPage();" onunload="GUnload();">

    <div id="content">
	
	<div id="header"><h1>Social Media Monitoring Extension</h1></div>	
	
	<div id="title" class="section-header first">Options</div>
	  
        <div class="option_row">
          <div class="option_name">Default geolocation:</div>
          <div class="option_picker">
        	<input type="radio" id="default_location_off" name="defaut_location" value="0" checked="checked"/><label for="default_location_off">anywhere</label><br/>
        	<input type="radio" id="default_location_on" name="defaut_location" value="1"/><label for="default_location_on">define your location</label>
         <div id="geo_options" class="hd">

			<div id="geolocform">
				<form action="javascript:void(0);" onsubmit="searchAddress(this.location.value); return false;"> 
			   	  <input id="location" type="text" name="location" value="Search Location" onfocus="if(this.value=='Search Location'){this.value='';}">
			   	  <select id="distance" name="distance"><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="60">60</option><option value="70">70</option><option value="80">80</option><option value="90">90</option><option value="100">100</option><option value="200">200</option></select>
			   	  <select id="unit" name="unit"><option value="km">kilometres</option>
			   	  <!--  <option value="mi">miles</option>-->
			   	  </select>
			   	  <br>
				</form>
			</div>
			   	
			<div id="map_canvas"></div>
			
			<span id="lat"></span> 
			<span id="lng"></span>
			
			</div>
         
          </div>
        </div>	  

        <!--<div class="option_row">
          <div class="option_name">Default On Click Behavior:</div>
          <div class="option_picker">
        <input type="radio" id="default" name="defaut_click" value="1" checked="checked"/><label for="default">Always show popup</label><br/>
        <input type="radio" id="off" name="defaut_click" value="0"/><label for="off">Never show popup (Go straight to browser tabs when new search result(s) exist)</label>
          </div>
        </div>-->	  
			  
        <div class="option_row">
          <div class="option_name">Update every:</div>
          <div class="option_picker">
            <select id="refresh-interval" name="refresh" onchange="markDirty()">
                <option value="1">1 minutes</option>
                <option value="5">5 minutes</option>
                <option value="10">10 minutes</option>
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="25">25 minutes</option>
                <option value="30" selected="selected">30 minutes</option>
                <option value="60">60 minutes</option>
            </select>
          </div>
        </div>
		
		<div class="option_row">
          <div class="option_name">Sound alert:</div>
          <div class="option_picker">
            <select id="sound-alert"  onchange="markDirty();">
              <option value="">None</option>
              <option value="http://chrome-social-media-monitoring.googlecode.com/files/sound01.ogg">Alert 1</option>
              <option value="http://chrome-social-media-monitoring.googlecode.com/files/sound02.ogg">Alert 2</option>
            </select>
          </div>
		  <input type="button" value="Play" onclick="playSound();" />
        </div>

        <div class="buttons">
          <button id="save_button" onclick="saveOptions();">Save</button>
		  <!-- TODO: implemet Reset -->
          <button id="reset_button" onclick="resetOptions();return false;">Reset</button>
          <span id="save_status">Options saved</span>
        </div>
      
	<div id="title" class="section-header first">License</div>
	This extension is released under the MIT license, and the code is available at <a href="http://code.google.com/p/chrome-social-media-monitoring/">Google Code Repository</a>.<br />
	<br />
	Icons created by <a href="http://www.icojoy.com/">Icojoy</a> (Stanislav Khodjaev) and <a href="http://www.komodomedia.com/">Komodo Media</a> (Rogie King), used as per the Creative Commons Attribution-Share Alike 3.0 Unported License.	    
    </div>
    
<!-- TODO: add extension link -->	
<div class="footr"><a href="http://code.google.com/p/chrome-social-media-monitoring/">Social Media Monitoring Homepage</a></div>

<script type="text/javascript"> 
	//var customDomainsTextbox;
	var saveButton;

	
	function _initOptionsPage() {
		saveButton = document.getElementById("save_button");
		if(bkg.settings.isFirstRun){
			markDirty();
		}else{
			markClean();
		}
		
	}

	function saveOptions() {
		markClean();

		save_options();
		return false;
	}
	
	function resetOptions() {
		 $('#refresh-interval').val("30");
		 $('#sound-alert').val("");
		 saveOptions();
		return false;
	}

	function markDirty() {
		saveButton.disabled = false;
	}

	function markClean() {
		saveButton.disabled = true;
	}
</script>
</body>
</html>