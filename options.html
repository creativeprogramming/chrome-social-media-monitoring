<!DOCTYPE html>
<html>
<head>
<title>Social Media Monitoring Extension Options</title>
<link rel="shortcut icon" HREF="img/icon_16.png"> 
<link rel="stylesheet" type="text/css" href="css/options.css">
<script type="text/javascript" src="lib/3rdparty/jquery-1.4.2.min.js"></script>

<script type="text/javascript"> 
var bkg = chrome.extension.getBackgroundPage();

//Saves options to localStorage.
function save_options() {
	bkg.settings.pollInterval = parseInt($('#refresh-interval').val()) * 60000;
	bkg.settings.timeout = 1000 * 15;

	bkg.settings.soundAlert = $('#sound-alert').val();
	
	
	
	refresh_extension();

	$('#save_status').fadeIn('fast');
	$('#save_status').fadeOut(3000);
}

//Refresh the extension by reseting timer.
function refresh_extension() {
	bkg.refresh(); 
}

function playSound(){
	var urlSound = $('#sound-alert').val();

	if(urlSound){
		pingSound = document.createElement('audio');
	    pingSound.setAttribute('src', urlSound);
	    pingSound.setAttribute('id', 'ping');
	    pingSound.load();
	    pingSound.play();
	}
}
/*
 * TODO: populate options interface 
 */
//Restores select box state to saved value from localStorage.
 $(function() {

	 $('#refresh-interval').val(bkg.settings.pollInterval / 60000);
	 $('#sound-alert').val(bkg.settings.soundAlert);

	 /*
	  * set  internatiolizaded values
	  */

	  $('#title').html(chrome.i18n.getMessage('options'));
	  

	 
 });
 
</script>
        
</head>
<body onload="_initOptionsPage();">
    <div id="content">
      <h1>
        <img src="img/logo_smmonitoring.png" title="SM Monitoring" alt="Social Media Monitoring"></h1>
	  <div id="title" class="section-header first">Options</div>
	  
      <form name="options_form" action="">
        <div class="option_row">
          <div class="option_name">Default On Click Behavior:</div>
          <div class="option_picker">
        <input type="radio" id="default" name="defaut_click" value="1" checked="checked"/><label for="default">Always show popup</label><br/>
        <input type="radio" id="off" name="defaut_click" value="0"/><label for="off">Never show popup (Go straight to browser tabs when new search result(s) exist)</label>
          </div>
        </div>	  
			  
        <div class="option_row">
          <div class="option_name">Update every:</div>
          <div class="option_picker">
            <select id="refresh-interval" name="refresh" onchange="markDirty()">
                <option value="5">5 minutes</option>
                <option value="10">10 minutes</option>
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="25">25 minutes</option>
                <option value="30" selected="selected">30 minutes</option>
                <option value="60">60 minutes</option>
            </select>
          </div>
        </div>
		
		<div class="option_row">
          <div class="option_name">Sound alert:</div>
          <div class="option_picker">
            <select id="sound-alert"  onchange="markDirty();">
              <option value="">None</option>
              <option value="http://work.max99x.com/cuckoo.ogg">Cuckoo</option>
              <option value="http://work.max99x.com/bell.ogg">Chime</option>
              <option value="http://work.max99x.com/cuckoo.ogg">Cuckoo</option>
            </select>
          </div>
		  <input type="button" value="Play" onclick="playSound();" />
        </div>

        <div class="buttons">
          <button id="save_button" onclick="saveOptions();">Save</button>
		  <!-- TODO: implemet Reset -->
          <button id="reset_button" onclick="resetOptions();return false;">Reset</button>
          <span id="save_status">Options saved</span>
        </div>
      </form>	  
    </div>
	
<!-- TODO: add extension link -->	
<div class="footr"><a href="http://code.google.com/p/chrome-social-media-monitoring/">Social Media Monitoring Homepage</a></div>

<script>
	//var customDomainsTextbox;
	var saveButton;

	
	function _initOptionsPage() {
		saveButton = document.getElementById("save_button");
		markClean();
	}

	function saveOptions() {
		markClean();

		save_options();
		return false;
	}
	
	function resetOptions() {
		 $('#refresh-interval').val("30");
		 $('#sound-alert').val("");
		 saveOptions();
		return false;
	}

	function markDirty() {
		saveButton.disabled = false;
	}

	function markClean() {
		saveButton.disabled = true;
	}
</script>
</body>
</html>